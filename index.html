<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Narcissus</title>
    <!-- å¼•å…¥å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <!-- å¼•å…¥MDè§£æåº“ -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        :root {
            --bg: #ffffff;         /* ç™½å¤©èƒŒæ™¯ */
            --text: #333333;       /* ç™½å¤©æ–‡å­—ä¸»è‰² */
            --border: #eeeeee;     /* è¾¹æ¡†è‰² */
            --switch-bg: #f0f0f0;  /* ä¸»é¢˜å¼€å…³èƒŒæ™¯ï¼ˆç™½å¤©ï¼‰ */
            --switch-circle: #fff; /* ä¸»é¢˜å¼€å…³æ»‘å—ï¼ˆç™½å¤©ï¼‰ */
            --switch-active: #007bff; /* ä¸»é¢˜å¼€å…³æ¿€æ´»è‰²ï¼ˆç™½å¤©ï¼‰ */
            --category-bg: #f9f9f9; /* ç±»ç›®å¡ç‰‡èƒŒæ™¯ï¼ˆç™½å¤©ï¼‰ */
            --category-text: #666; /* ç±»ç›®æè¿°æ–‡å­—è‰²ï¼ˆç™½å¤©ï¼‰ */
            --tag-active-color: #0070f3; /* é€‰ä¸­æ ‡ç­¾é¢œè‰²ï¼ˆç™½å¤©ï¼‰ */
            --category-active-bg: #f0f5ff; /* é€‰ä¸­ç±»ç›®å¡ç‰‡èƒŒæ™¯ï¼ˆç™½å¤©ï¼‰ */
            --btn-bg: #f5f5f5;     /* æŒ‰é’®èƒŒæ™¯ï¼ˆç™½å¤©ï¼‰ */
            --btn-hover: #eee;     /* æŒ‰é’®hoverï¼ˆç™½å¤©ï¼‰ */
        }

        body.dark-mode {
            --bg: #1e1e1e;         /* æš—é»‘èƒŒæ™¯ */
            --text: #e0e0e0;       /* æš—é»‘æ–‡å­—ä¸»è‰² */
            --border: #333333;     /* æš—é»‘è¾¹æ¡†è‰² */
            --switch-bg: #333333;  /* ä¸»é¢˜å¼€å…³èƒŒæ™¯ï¼ˆæš—é»‘ï¼‰ */
            --switch-active: #66b3ff; /* ä¸»é¢˜å¼€å…³æ¿€æ´»è‰²ï¼ˆæš—é»‘ï¼‰ */
            --category-bg: #2a2a2a; /* ç±»ç›®å¡ç‰‡èƒŒæ™¯ï¼ˆæš—é»‘ï¼‰ */
            --category-text: #ccc; /* ç±»ç›®æè¿°æ–‡å­—è‰²ï¼ˆæš—é»‘ï¼‰ */
            --tag-active-color: #66b3ff; /* é€‰ä¸­æ ‡ç­¾é¢œè‰²ï¼ˆæš—é»‘ï¼‰ */
            --category-active-bg: #2c3e50; /* é€‰ä¸­ç±»ç›®å¡ç‰‡èƒŒæ™¯ï¼ˆæš—é»‘ï¼‰ */
            --btn-bg: #333;        /* æŒ‰é’®èƒŒæ™¯ï¼ˆæš—é»‘ï¼‰ */
            --btn-hover: #444;     /* æŒ‰é’®hoverï¼ˆæš—é»‘ï¼‰ */
        }

        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            transition: background-color 0.3s, color 0.3s;
            padding: 0;
        }

        /* å¯¼èˆªæ æ ·å¼ */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--bg);
            padding: 12px 24px;
            border-bottom: 1px solid var(--border);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .title {
            font-size: 20px;
            font-weight: 600;
            text-decoration: none;
            color: var(--text);
            cursor: pointer;
            transition: color 0.2s;
        }

        .title:hover {
            color: #666;
        }

        .navbar-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .nav-link {
            margin-left: 20px;
            text-decoration: none;
            color: var(--text);
            font-size: 14px;
            transition: color 0.2s;
            cursor: pointer;
        }

        .nav-link:hover {
            color: #666;
        }

        /* ä¸»é¢˜åˆ‡æ¢å¼€å…³ */
        .theme-switch {
            display: flex;
            align-items: center;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 20px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--switch-bg);
            transition: 0.4s;
            border-radius: 20px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 2px;
            bottom: 2px;
            background-color: var(--switch-circle);
            transition: 0.4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--switch-active);
        }

        input:checked + .slider:before {
            transform: translateX(20px);
        }

        /* å†…å®¹åŒºåŸŸé€šç”¨æ ·å¼ */
        .content {
            max-width: 800px;
            margin: 20px auto;
            padding: 0 24px;
        }

        /* ç±»ç›®å®¹å™¨ï¼ˆæ¨ªå‘æ»šåŠ¨ï¼‰ */
        .categories {
            display: flex;
            gap: 15px;
            overflow-x: auto;
            padding-bottom: 10px;
            margin-top: 20px;
        }

        /* ç±»ç›®å¡ç‰‡ */
        .category {
            min-width: 220px;
            padding: 12px;
            background-color: var(--category-bg);
            border-radius: 8px;
            box-sizing: border-box;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .category.active {
            background-color: var(--category-active-bg);
        }

        .category h2 {
            font-size: 14px;
            font-weight: bold;
            margin: 0 0 6px;
            color: var(--text);
        }

        .category p {
            font-size: 12px;
            color: var(--category-text);
            line-height: 1.5;
            margin: 0;
            text-indent: 2em;
        }

        /* æ ‡ç­¾æ ï¼ˆæ¨ªå‘æ»šåŠ¨ï¼‰ */
        .tags {
            display: flex;
            gap: 12px;
            margin-top: 10px;
            overflow-x: auto;
            white-space: nowrap;
            padding-bottom: 8px;
            scrollbar-width: thin;
        }

        .tags::-webkit-scrollbar {
            height: 4px;
        }

        .tags::-webkit-scrollbar-thumb {
            background-color: var(--border);
            border-radius: 2px;
        }

        .tag {
            padding: 4px 8px;
            cursor: pointer;
            color: var(--text);
            transition: color 0.2s, border-bottom-color 0.2s;
            border-bottom: 2px solid transparent;
            font-size: 12px;
        }

        .tag.active {
            color: var(--tag-active-color);
            border-bottom-color: var(--tag-active-color);
            font-weight: 500;
        }

        .tag:hover {
            color: var(--tag-active-color);
        }

        /* æŒ‰é’®æ ·å¼ï¼ˆåˆ›å»º/ä¿å­˜/è¿”å›ï¼‰ */
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            background-color: var(--btn-bg);
            color: var(--text);
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
            margin: 10px 0;
        }

        .btn:hover {
            background-color: var(--btn-hover);
        }

        .btn-primary {
            background-color: var(--tag-active-color);
            color: #fff;
        }

        .btn-primary:hover {
            background-color: #0060d0;
        }

        /* ç±»ç›®å­é¡µå®¹å™¨ */
        .page-container {
            margin-top: 20px;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* æ–‡ç« åˆ—è¡¨ï¼ˆä¼˜åŒ–åï¼‰ */
        .article {
            display: flex;
            gap: 20px;
            padding: 15px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 8px;
        }

        .article:hover {
            background-color: rgba(0, 0, 0, 0.03);
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .article-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .article-title {
            font-size: 16px;
            font-weight: 600;
            margin: 0;
            color: var(--text);
            transition: color 0.2s;
        }

        .article:hover .article-title {
            color: var(--tag-active-color);
        }

        /* æ–°å¢ï¼šæ–‡ç« æ ‡ç­¾æ˜¾ç¤º */
        .article-tags {
            display: flex;
            gap: 6px;
            margin-bottom: 4px;
        }

        .article-tag {
            font-size: 11px;
            padding: 2px 6px;
            background-color: rgba(0, 112, 243, 0.1);
            color: var(--tag-active-color);
            border-radius: 4px;
        }

        .article-desc {
            font-size: 12px;
            color: var(--category-text);
            line-height: 1.6;
            margin: 0;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .article-meta {
            display: flex;
            align-items: center;
            gap: 16px;
            font-size: 11px;
            color: #999;
            margin-top: auto;
        }

        /* æ–°å¢ï¼šé˜…è¯»æ—¶é•¿å ä½ */
        .article-readtime {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .article-img {
            width: 120px;
            height: 80px;
            object-fit: cover;
            border-radius: 6px;
            transition: transform 0.3s ease;
        }

        .article:hover .article-img {
            transform: scale(1.03);
        }

        /* åŠ è½½çŠ¶æ€ */
        .loading {
            text-align: center;
            padding: 40px 0;
            color: var(--category-text);
            font-size: 14px;
        }

        .loading::after {
            content: "";
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid var(--border);
            border-top-color: var(--tag-active-color);
            border-radius: 50%;
            margin-left: 8px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ç©ºçŠ¶æ€ä¼˜åŒ– */
        .empty-state {
            text-align: center;
            padding: 60px 0;
            color: var(--category-text);
        }

        .empty-state i {
            font-size: 48px;
            margin-bottom: 16px;
            color: var(--border);
        }

        .empty-state p {
            margin: 0 0 20px;
            font-size: 14px;
        }

        /* åˆ†é¡µæŒ‰é’®æ ·å¼ */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin: 20px 0;
            padding: 10px 0;
        }

        .pagination-btn {
            padding: 4px 12px;
            border: 1px solid var(--border);
            border-radius: 4px;
            background-color: var(--bg);
            color: var(--text);
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        .pagination-btn:hover:not(.disabled):not(.active) {
            border-color: var(--tag-active-color);
            color: var(--tag-active-color);
        }

        .pagination-btn.active {
            background-color: var(--tag-active-color);
            color: #fff;
            border-color: var(--tag-active-color);
        }

        .pagination-btn.disabled {
            cursor: not-allowed;
            opacity: 0.5;
        }

        /* æ’åºæ§ä»¶æ ·å¼ */
        .sort-control {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* åˆ›å»ºæ–‡ç« è¡¨å• */
        .create-form {
            margin: 20px 0;
            padding: 20px;
            background-color: var(--category-bg);
            border-radius: 8px;
            display: none;
        }

        .create-form.active {
            display: block;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--border);
            border-radius: 4px;
            background-color: var(--bg);
            color: var(--text);
            font-size: 14px;
            box-sizing: border-box;
        }

        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }

        /* æ–°å¢ï¼šMDä¸Šä¼ æŒ‰é’®æ ·å¼ */
        .md-upload-group {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        #mdFileInput {
            display: none;
        }

        .md-upload-btn {
            padding: 6px 12px;
            border: 1px solid var(--tag-active-color);
            color: var(--tag-active-color);
            background: transparent;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: background 0.2s;
        }

        .md-upload-btn:hover {
            background-color: rgba(0, 112, 243, 0.1);
        }

        /* ç¼–è¾‘é¡µé¢ï¼ˆé•¿æ–‡ç¼–è¾‘ï¼‰ */
        .edit-page {
            display: none;
            height: 100vh;
            flex-direction: column;
            background-color: var(--bg);
        }

        .edit-page.active {
            display: flex;
        }

        .edit-page .navbar {
            padding: 10px 16px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .edit-page .btn {
            padding: 6px 12px;
            font-size: 14px;
            margin: 0;
        }

        .edit-content {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
        }

        .edit-content #editTitle {
            width: 100%;
            padding: 8px;
            font-size: 18px;
            border: none;
            border-bottom: 1px solid var(--border);
            background-color: transparent;
            color: var(--text);
            margin-bottom: 16px;
        }

        /* å¯Œæ–‡æœ¬ç¼–è¾‘å™¨å®¹å™¨ï¼ˆç¼–è¾‘é¡µä¸“ç”¨ï¼‰ */
        .edit-content #editor-container {
            height: calc(100vh - 160px);
            border: none;
            background-color: transparent;
            font-size: 16px;
            line-height: 1.6;
        }

        /* è°ƒæ•´Quillå·¥å…·æ æ ·å¼ä¸ºç´§å‡‘ç‰ˆ */
        .ql-toolbar {
            flex-wrap: nowrap;
            overflow-x: auto;
            padding: 8px !important;
            gap: 8px !important;
            border: none !important;
            box-shadow: none !important;
        }

        .ql-toolbar .ql-formats {
            margin: 0 !important;
        }

        .ql-toolbar button, .ql-toolbar select {
            width: 28px;
            height: 28px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .edit-toolbar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-around;
            padding: 10px;
            background-color: var(--category-bg);
            border-top: 1px solid var(--border);
            z-index: 10;
        }

        .tool-btn {
            background: none;
            border: none;
            color: var(--text);
            cursor: pointer;
            font-size: 24px;
        }

        /* æ–‡ç« è¯¦æƒ…é¡µæ ·å¼ */
        #articleDetailPage {
            display: none;
        }

        .article-detail {
            padding: 20px 0;
        }

        .article-detail h1 {
            font-size: 24px;
            margin-bottom: 12px;
        }

        .meta {
            display: flex;
            gap: 16px;
            font-size: 12px;
            color: #999;
            margin-bottom: 20px;
        }

        .content-html {
            line-height: 1.8;
            font-size: 16px;
        }

        .content-html h2 {
            margin: 24px 0 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border);
        }

        .content-html ul, .content-html ol {
            padding-left: 24px;
            margin: 12px 0;
        }

        .content-html img {
            max-width: 100%;
            border-radius: 8px;
            margin: 16px 0;
        }

        /* åˆå§‹éšè—é¡µé¢ */
        #archiveContent, #articleDetailPage, .edit-page, .create-form {
            display: none;
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <div class="navbar">
        <div class="title" id="homeLink">Narcissus</div>
        <div class="navbar-right">
            <div class="nav-link" id="archiveLink">æ¡£æ¡ˆ</div>
            <div class="nav-link">æœç´¢</div>
            <div class="nav-link">æ ‡ç­¾</div>
            <div class="theme-switch">
                <label class="switch">
                    <input type="checkbox" id="themeToggle">
                    <span class="slider"></span>
                </label>
            </div>
        </div>
    </div>

    <!-- ä¸»é¡µå†…å®¹ -->
    <div class="content" id="mainContent">
        <h1>æ¬¢è¿æ¥åˆ° Narcissus</h1>
        <p>è¿™æ˜¯ä¸»é¡µé¢å†…å®¹ï¼Œç‚¹å‡»ä¸Šæ–¹ã€Œæ¡£æ¡ˆã€å¯æŸ¥çœ‹åˆ†ç±»å†…å®¹ã€‚</p>
    </div>

    <!-- æ¡£æ¡ˆå†…å®¹ -->
    <div class="content" id="archiveContent">
        <!-- æ’åº+ç±»ç›®æ ‡é¢˜å®¹å™¨ -->
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
            <h2 style="margin: 0; font-size: 18px;">æ–‡ç« åˆ†ç±»</h2>
            <div class="sort-control">
                <span style="font-size: 12px; color: var(--category-text);">æ’åºï¼š</span>
                <select id="sortSelect">
                    <option value="newest">æœ€æ–°å‘å¸ƒ</option>
                    <option value="oldest">æœ€æ—©å‘å¸ƒ</option>
                </select>
            </div>
        </div>

        <!-- ç±»ç›®å¡ç‰‡åŒºåŸŸ -->
        <div class="categories" id="categories">
            <div class="category active" data-page="programming">
                <h2>ç¼–ç¨‹</h2>
                <p>ä¸»è¦å›´ç»•Obsidianå·¥å…·ä¸ç¼–ç¨‹å…¥é—¨å†…å®¹çš„åˆ†äº«ã€‚</p>
            </div>
            <div class="category" data-page="jewelry">
                <h2>ç å®</h2>
                <p>ç å®è®¾è®¡ç†å¿µã€æè´¨å·¥è‰ºä¸å†å²æ–‡åŒ–çš„åˆ†äº«ã€‚</p>
            </div>
            <div class="category" data-page="design">
                <h2>è®¾è®¡</h2>
                <p>UI/UXè®¾è®¡ç†å¿µä¸è½¯ä»¶æ“ä½œï¼Œè‰²å½©æ’ç‰ˆçŸ¥è¯†ã€‚</p>
            </div>
            <div class="category" data-page="reading">
                <h2>é˜…è¯»</h2>
                <p>ä¼˜è´¨ä¹¦ç±æ¨èä¸é«˜æ•ˆé˜…è¯»æ³•ï¼ŒçŸ¥è¯†ç®¡ç†ç§¯ç´¯ã€‚</p>
            </div>
            <div class="category" data-page="art">
                <h2>è‰ºæœ¯</h2>
                <p>ç»˜ç”»ã€æ‘„å½±ã€éŸ³ä¹åˆ›ä½œå¿ƒå¾—ä¸ä½œå“èµæã€‚</p>
            </div>
        </div>

        <!-- æ ‡ç­¾æ  -->
        <div class="tags" id="tagsContainer"></div>

        <!-- åˆ†é¡µç»„ä»¶ -->
        <div class="pagination" id="pagination"></div>

        <!-- æ“ä½œæŒ‰é’®ï¼ˆåˆ›å»ºæ–°æ–‡ç« ï¼‰ -->
        <button class="btn btn-primary" id="createBtn">åˆ›å»ºæ–°æ–‡ç« </button>

        <!-- åˆ›å»ºæ–‡ç« è¡¨å•ï¼ˆå«MDä¸Šä¼ ï¼‰ -->
        <div class="create-form" id="createForm">
            <div class="form-group">
                <label for="articleTitle">æ–‡ç« æ ‡é¢˜</label>
                <input type="text" id="articleTitle" placeholder="è¾“å…¥æ–‡ç« æ ‡é¢˜ï¼ˆä¸Šä¼ MDå¯è‡ªåŠ¨æå–ï¼‰">
            </div>
            <div class="form-group">
                <label for="articleDate">å‘å¸ƒæ—¥æœŸ</label>
                <input type="date" id="articleDate">
            </div>
            <div class="form-group">
                <label for="articleDesc">æ–‡ç« æ‘˜è¦</label>
                <textarea id="articleDesc" placeholder="è¾“å…¥æ–‡ç« æ‘˜è¦ï¼ˆä¸Šä¼ MDå¯è‡ªåŠ¨æå–å‰100å­—ï¼‰"></textarea>
            </div>
            <div class="form-group">
                <label for="articleImg">å›¾ç‰‡URLï¼ˆå¯é€‰ï¼‰</label>
                <input type="text" id="articleImg" placeholder="è¾“å…¥å›¾ç‰‡é“¾æ¥">
            </div>
            <!-- MDæ–‡ä»¶ä¸Šä¼ æ§ä»¶ -->
            <div class="form-group md-upload-group">
                <label>ä¸Šä¼ MDæ–‡æ¡£</label>
                <input type="file" id="mdFileInput" accept=".md">
                <button class="md-upload-btn" id="mdUploadBtn">é€‰æ‹©MDæ–‡ä»¶</button>
                <span id="mdFileName" style="font-size: 12px; color: var(--category-text);"></span>
            </div>
            <div class="form-group">
                <label for="articleCategory">æ‰€å±ç±»ç›®</label>
                <select id="articleCategory">
                    <option value="programming">ç¼–ç¨‹</option>
                    <option value="jewelry" selected>ç å®</option>
                    <option value="design">è®¾è®¡</option>
                    <option value="reading">é˜…è¯»</option>
                    <option value="art">è‰ºæœ¯</option>
                </select>
            </div>
            <button class="btn btn-primary" id="saveCreateBtn">ä¿å­˜æ–‡ç« </button>
            <button class="btn" id="cancelCreateBtn">å–æ¶ˆ</button>
        </div>

        <!-- ç±»ç›®å­é¡µå®¹å™¨ -->
        <div class="page-container" id="pageContainer">
            <div class="page active" id="programmingPage">
                <div class="article-list" id="programmingList"></div>
            </div>
            <div class="page" id="jewelryPage">
                <div class="article-list" id="jewelryList"></div>
            </div>
            <div class="page" id="designPage">
                <div class="article-list" id="designList"></div>
            </div>
            <div class="page" id="readingPage">
                <div class="article-list" id="readingList"></div>
            </div>
            <div class="page" id="artPage">
                <div class="article-list" id="artList"></div>
            </div>
        </div>
    </div>

    <!-- æ–‡ç« è¯¦æƒ…é¡µ -->
    <div class="content" id="articleDetailPage">
        <div class="article-detail">
            <h1 id="detailTitle">æ–‡ç« æ ‡é¢˜</h1>
            <div class="meta">
                <span id="detailDate">2025-01-01</span>
                <span id="detailCategory">åˆ†ç±»</span>
                <span id="detailReadTime">5åˆ†é’Ÿé˜…è¯»</span>
            </div>
            <div id="detailContent" class="content-html"></div>
            <button class="btn btn-primary" id="editArticleBtn">ç¼–è¾‘æ–‡ç« </button>
        </div>
    </div>

    <!-- ç¼–è¾‘é¡µé¢ -->
    <div class="edit-page" id="editPage">
        <div class="navbar">
            <button class="btn" id="backToDetailBtn">è¿”å›è¯¦æƒ…</button>
            <button class="btn btn-primary" id="saveEditBtn">ä¿å­˜</button>
            <button class="btn" id="nextStepBtn" style="opacity: 0.7; cursor: not-allowed;">ä¸‹ä¸€æ­¥</button>
        </div>
        <div class="edit-content">
            <input type="text" id="editTitle" placeholder="è¾“å…¥æ ‡é¢˜">
            <div id="editor-container"></div>
        </div>
        <div class="edit-toolbar">
            <button class="tool-btn" id="imgToolBtn">ğŸ“·</button>
            <button class="tool-btn" id="formatToolBtn">Aâ™¯</button>
            <button class="tool-btn" id="moreToolBtn">â‹¯</button>
            <!-- ç¼–è¾‘é¡µMDä¸Šä¼ æŒ‰é’® -->
            <label class="tool-btn" style="cursor: pointer;" title="ä¸Šä¼ MDæ›¿æ¢å†…å®¹">ğŸ“„</label>
            <input type="file" id="editMdFileInput" accept=".md" style="display: none;">
        </div>
        <input type="hidden" id="editArticleId">
    </div>

    <script>
        // åˆå§‹åŒ–å¯Œæ–‡æœ¬ç¼–è¾‘å™¨
        const quill = new Quill('#editor-container', {
            theme: 'snow',
            modules: {
                toolbar: [
                    ['bold', 'italic', 'underline', 'strike'],
                    ['blockquote', 'code-block'],
                    [{ 'header': [1, 2, 3, 4, 5, 6, false] }],
                    [{ 'list': 'ordered' }, { 'list': 'bullet' }],
                    [{ 'indent': '-1' }, { 'indent': '+1' }],
                    ['link', 'image'],
                    ['clean']
                ]
            },
            placeholder: 'æƒ³è¯´ç‚¹ä»€ä¹ˆ...ï¼ˆæ”¯æŒå¯Œæ–‡æœ¬æ ¼å¼ï¼Œå¯ç¼–è¾‘é•¿æ–‡ï¼‰'
        });

        // å…¨å±€ç­›é€‰/æ’åº/åˆ†é¡µçŠ¶æ€
        let currentFilter = {
            categoryId: 'programming',
            tag: 'å…¨éƒ¨',
            tagKeywords: [],
            sortType: 'newest',
            page: 1,
            pageSize: 5,
            totalPages: 0
        };

        // 1. ä¸»é¢˜åˆ‡æ¢é€»è¾‘
        const themeToggle = document.getElementById('themeToggle');
        const body = document.body;
        themeToggle.addEventListener('change', () => {
            body.classList.toggle('dark-mode');
            // åŒæ­¥å¯Œæ–‡æœ¬ç¼–è¾‘å™¨æ ·å¼
            document.querySelector('.ql-toolbar').style.backgroundColor = getComputedStyle(body).getPropertyValue('--category-bg');
            document.querySelector('.ql-container').style.backgroundColor = getComputedStyle(body).getPropertyValue('--bg');
        });

        // 2. é¡µé¢åˆ‡æ¢é€»è¾‘ï¼ˆä¸»é¡µ â†” æ¡£æ¡ˆï¼‰
        const homeLink = document.getElementById('homeLink');
        const archiveLink = document.getElementById('archiveLink');
        const mainContent = document.getElementById('mainContent');
        const archiveContent = document.getElementById('archiveContent');
        archiveLink.addEventListener('click', () => {
            mainContent.style.display = 'none';
            archiveContent.style.display = 'block';
            initArticleRender(); // åˆå§‹åŒ–ç­›é€‰æ¸²æŸ“
            window.location.hash = ''; // é‡ç½®è·¯ç”±
        });
        homeLink.addEventListener('click', () => {
            archiveContent.style.display = 'none';
            mainContent.style.display = 'block';
            hideAllPages();
        });

        // 3. ç±»ç›®-æ ‡ç­¾æ˜ å°„è¡¨
        const categoryTagsMap = {
            programming: [
                { name: 'å…¨éƒ¨', active: true, keywords: [] },
                { name: 'JavaScript', active: false, keywords: ['JS', 'JavaScript', 'è„šæœ¬'] },
                { name: 'Vue', active: false, keywords: ['Vue', 'Vue3', 'Vue2'] },
                { name: 'React', active: false, keywords: ['React', 'React Hook'] },
                { name: 'Obsidian', active: false, keywords: ['Obsidian', 'é»‘æ›œçŸ³'] },
                { name: 'ç®—æ³•', active: false, keywords: ['ç®—æ³•', 'æ’åº', 'æŸ¥æ‰¾'] }
            ],
            jewelry: [
                { name: 'å…¨éƒ¨', active: true, keywords: [] },
                { name: 'é’»çŸ³', active: false, keywords: ['é’»çŸ³', '4C', 'å…‹æ‹‰'] },
                { name: 'å¤æ³•é‡‘', active: false, keywords: ['å¤æ³•é‡‘', 'é»„é‡‘', 'è¶³é‡‘'] },
                { name: 'ç å®è®¾è®¡', active: false, keywords: ['è®¾è®¡', 'å›¾çº¸', 'æ¬¾å¼'] },
                { name: '3Då»ºæ¨¡', active: false, keywords: ['3D', 'å»ºæ¨¡', 'CAD'] },
                { name: 'æè´¨', active: false, keywords: ['æè´¨', 'é“‚é‡‘', 'Ké‡‘'] },
                { name: 'ç¢§çº', active: false, keywords: ['ç¢§çº', 'å¢æ¯”æ¥', 'ç”µæ°”çŸ³'] }
            ],
            design: [
                { name: 'å…¨éƒ¨', active: true, keywords: [] },
                { name: 'Figma', active: false, keywords: ['Figma', 'è®¾è®¡å·¥å…·'] },
                { name: 'UI', active: false, keywords: ['UI', 'ç•Œé¢', 'è§†è§‰'] },
                { name: 'UX', active: false, keywords: ['UX', 'ä½“éªŒ', 'äº¤äº’'] },
                { name: 'ç»„ä»¶åº“', active: false, keywords: ['ç»„ä»¶åº“', 'ç»„ä»¶', 'å¤ç”¨'] },
                { name: 'æ’ç‰ˆ', active: false, keywords: ['æ’ç‰ˆ', 'å­—ä½“', 'å¸ƒå±€'] }
            ],
            reading: [
                { name: 'å…¨éƒ¨', active: true, keywords: [] },
                { name: 'ç¼–ç¨‹ä¹¦ç±', active: false, keywords: ['ç¼–ç¨‹', 'ä»£ç ', 'å¼€å‘'] },
                { name: 'çŸ¥è¯†ç®¡ç†', active: false, keywords: ['çŸ¥è¯†', 'ç®¡ç†', 'ç¬”è®°'] },
                { name: 'è¯»ä¹¦ç¬”è®°', active: false, keywords: ['ç¬”è®°', 'è¯»åæ„Ÿ', 'æ‘˜æŠ„'] },
                { name: 'é«˜æ•ˆé˜…è¯»', active: false, keywords: ['é«˜æ•ˆ', 'é€Ÿè¯»', 'æ–¹æ³•'] }
            ],
            art: [
                { name: 'å…¨éƒ¨', active: true, keywords: [] },
                { name: 'ç»˜ç”»', active: false, keywords: ['ç»˜ç”»', 'ç´ æ', 'è‰²å½©'] },
                { name: 'æ‘„å½±', active: false, keywords: ['æ‘„å½±', 'æ„å›¾', 'å…‰å½±'] },
                { name: 'éŸ³ä¹', active: false, keywords: ['éŸ³ä¹', 'ä½œæ›²', 'ä¹å™¨'] },
                { name: 'å°è±¡æ´¾', active: false, keywords: ['å°è±¡æ´¾', 'è«å¥ˆ', 'æ¢µé«˜'] }
            ]
        };

        // 4. æ¸²æŸ“æ ‡ç­¾æ 
        const tagsContainer = document.getElementById('tagsContainer');
        function renderTags(categoryId) {
            tagsContainer.innerHTML = '';
            const tags = categoryTagsMap[categoryId] || [];
            tags.forEach(tag => {
                const tagElement = document.createElement('span');
                tagElement.className = `tag${tag.active ? ' active' : ''}`;
                tagElement.textContent = tag.name;
                tagElement.addEventListener('click', () => {
                    tags.forEach(t => t.active = false);
                    tag.active = true;
                    currentFilter.tag = tag.name;
                    currentFilter.tagKeywords = tag.keywords;
                    currentFilter.page = 1;
                    renderTags(categoryId);
                    renderArticleListWithFilter();
                    renderPagination();
                });
                tagsContainer.appendChild(tagElement);
            });
        }

        // 5. ç±»ç›®åˆ‡æ¢é€»è¾‘
        const categories = document.querySelectorAll('.category');
        const pages = document.querySelectorAll('.page');
        categories.forEach(category => {
            category.addEventListener('click', () => {
                categories.forEach(c => c.classList.remove('active'));
                category.classList.add('active');
                const categoryId = category.getAttribute('data-page');
                currentFilter.categoryId = categoryId;
                currentFilter.tag = 'å…¨éƒ¨';
                currentFilter.tagKeywords = [];
                currentFilter.page = 1;
                pages.forEach(page => {
                    page.classList.remove('active');
                    document.getElementById(`${categoryId}Page`).classList.add('active');
                });
                renderTags(categoryId);
                renderArticleListWithFilter();
                renderPagination();
                hideAllPages();
            });
        });

        // 6. æ’åºäº‹ä»¶ç›‘å¬
        document.getElementById('sortSelect').addEventListener('change', (e) => {
            currentFilter.sortType = e.target.value;
            currentFilter.page = 1;
            renderArticleListWithFilter();
            renderPagination();
        });

        // 7. æ–‡ç« æ•°æ®ç®¡ç†ï¼ˆlocalStorageï¼‰
        const ARTICLE_KEY = 'narcissus_articles';

        function initDefaultArticles() {
            const defaultArticles = [
                {
                    id: '1',
                    category: 'programming',
                    title: 'Chrome æ‰©å±•å¼€å‘å®æˆ˜ï¼šGoogle Maps é‚®ç¼–æ ‡æ³¨å·¥å…·',
                    date: '2025-05-09',
                    desc: 'è¿™æ¬¾ Chrome æ‰©å±•ç¨‹åºå¯åœ¨ Google Maps ä¸Šæ‰¹é‡æ ‡æ³¨æ¾³å¤§åˆ©äºšé‚®ç¼–ä½ç½®ï¼Œè‡ªåŠ¨è§£æé‚®ç¼–è¾¹ç•Œä¸è¯¦æƒ…...',
                    img: 'https://picsum.photos/200/150?random=1',
                    content: '<p>### ä¸€ã€å¼€å‘èƒŒæ™¯</p><p>åœ¨å¤„ç†æ¾³å¤§åˆ©äºšåœ°ç†æ•°æ®æ—¶ï¼Œéœ€è¦å¿«é€Ÿæ ‡æ³¨é‚®ç¼–åŒºåŸŸ...</p>'
                },
                {
                    id: '2',
                    category: 'jewelry',
                    title: 'ç¢§çºé€‰è´­æŒ‡å—ï¼šé¢œè‰²ã€å‡€åº¦ä¸äº§åœ°å¯¹ä»·å€¼çš„å½±å“',
                    date: '2025-04-10',
                    desc: 'è¯¦è§£ç¢§çºâ€œçº¢ã€è“ã€ç»¿â€ä¸‰å¤§çƒ­é—¨è‰²ç³»ç‰¹ç‚¹ï¼Œæ•™ä½ è¾¨åˆ«å¤©ç„¶ç¢§çºä¸ä¼˜åŒ–å¤„ç†å“...',
                    img: 'https://picsum.photos/200/150?random=12',
                    content: '<p>### ä¸€ã€ç¢§çºçš„é¢œè‰²åˆ†ç±»</p><p>1. çº¢è‰²ç¢§çºï¼šåˆç§°â€œå¢æ¯”æ¥â€ï¼Œä»¥é²œè‰³çš„æ­£çº¢è‰²ä¸ºè´µ...</p>'
                },
                {
                    id: '3',
                    category: 'jewelry',
                    title: 'é’»çŸ³4Cåˆ†çº§æŒ‡å—',
                    date: '2025-04-15',
                    desc: 'ä»é‡é‡ã€é¢œè‰²ã€å‡€åº¦ã€åˆ‡å·¥è§£æé’»çŸ³ä»·å€¼ï¼Œé¿å‘æŒ‘é€‰æŠ€å·§å…¨åˆ†äº«...',
                    img: 'https://picsum.photos/200/150?random=10',
                    content: '<p>### ä¸€ã€é’»çŸ³é‡é‡ï¼ˆCaratï¼‰</p><p>1å…‹æ‹‰=0.2å…‹ï¼Œé’»çŸ³ä»·æ ¼ä¸é‡é‡å‘ˆéçº¿æ€§å¢é•¿...</p>'
                },
                {
                    id: '4',
                    category: 'design',
                    title: 'Figmaç»„ä»¶åº“æ­å»ºæŒ‡å—',
                    date: '2025-03-20',
                    desc: 'ä»é›¶æ­å»ºå¯å¤ç”¨Figmaç»„ä»¶åº“ï¼ŒåŒ…å«æŒ‰é’®ã€è¾“å…¥æ¡†ç­‰åŸºç¡€ç»„ä»¶ï¼Œæå‡è®¾è®¡æ•ˆç‡...',
                    img: 'https://picsum.photos/200/150?random=5',
                    content: '<p>### ä¸€ã€ç»„ä»¶åº“è§„åˆ’</p><p>1. ç¡®å®šç»„ä»¶èŒƒå›´ï¼šåŸºç¡€ç»„ä»¶+ä¸šåŠ¡ç»„ä»¶...</p>'
                },
                {
                    id: '5',
                    category: 'reading',
                    title: 'ã€ŠåŸå­ä¹ æƒ¯ã€‹è¯»ä¹¦ç¬”è®°ï¼šå¦‚ä½•å…»æˆæŒä¹…çš„å¥½ä¹ æƒ¯',
                    date: '2025-02-18',
                    desc: 'æ‹†è§£â€œå¾®å°æ”¹å˜ï¼Œå·¨å¤§æˆæœâ€çš„æ ¸å¿ƒé€»è¾‘ï¼Œåˆ†äº«4ä¸ªä¹ æƒ¯å…»æˆæ­¥éª¤...',
                    img: 'https://picsum.photos/200/150?random=8',
                    content: '<p>### æ ¸å¿ƒè§‚ç‚¹ï¼š1%çš„å¾®å°è¿›æ­¥</p><p>ä¹ æƒ¯çš„å¤åˆ©æ•ˆåº”ï¼šæ¯å¤©è¿›æ­¥1%ï¼Œä¸€å¹´åæå‡37å€...</p>'
                },
                {
                    id: '6',
                    category: 'art',
                    title: 'å°è±¡æ´¾ç»˜ç”»ç‰¹ç‚¹è§£æï¼šä»¥è«å¥ˆã€Šç¡è²ã€‹ä¸ºä¾‹',
                    date: '2025-01-30',
                    desc: 'ä»å…‰å½±ã€è‰²å½©ã€ç¬”è§¦ä¸‰æ–¹é¢åˆ†æå°è±¡æ´¾çš„è‰ºæœ¯ç‰¹è‰²ï¼Œè§£è¯»ã€Šç¡è²ã€‹ä¸­çš„è‡ªç„¶è¡¨è¾¾...',
                    img: 'https://picsum.photos/200/150?random=3',
                    content: '<p>### ä¸€ã€å…‰å½±çš„ç¬é—´æ•æ‰</p><p>å°è±¡æ´¾æ‘’å¼ƒä¼ ç»Ÿæš—éƒ¨ç”»æ³•ï¼Œç”¨è‰²å½©ç›´æ¥è¡¨ç°å…‰å½±å˜åŒ–...</p>'
                }
            ];
            if (!localStorage.getItem(ARTICLE_KEY)) {
                localStorage.setItem(ARTICLE_KEY, JSON.stringify(defaultArticles));
            }
        }

        function getArticles() {
            initDefaultArticles();
            return JSON.parse(localStorage.getItem(ARTICLE_KEY) || '[]');
        }

        function saveArticle(article) {
            const articles = getArticles();
            const index = articles.findIndex(a => a.id === article.id);
            if (index > -1) {
                articles[index] = article;
            } else {
                article.id = Date.now().toString();
                articles.push(article);
            }
            localStorage.setItem(ARTICLE_KEY, JSON.stringify(articles));
            return article;
        }

        function getArticlesByCategory(categoryId) {
            const articles = getArticles();
            return articles.filter(a => a.category === categoryId);
        }

        function getArticleById(id) {
            const articles = getArticles();
            return articles.find(a => a.id === id);
        }

        // 8. å¸¦ç­›é€‰/æ’åº/åˆ†é¡µçš„æ–‡ç« åˆ—è¡¨æ¸²æŸ“
        function renderArticleListWithFilter() {
            const { categoryId, tagKeywords, sortType, page, pageSize } = currentFilter;
            const listContainer = document.getElementById(`${categoryId}List`);
            if (!listContainer) return;

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            listContainer.innerHTML = '<div class="loading">åŠ è½½ä¸­...</div>';

            // ç­›é€‰é€»è¾‘
            let articles = getArticlesByCategory(categoryId);
            if (tagKeywords.length > 0) {
                articles = articles.filter(article => 
                    tagKeywords.some(keyword => 
                        article.title.includes(keyword) || article.desc.includes(keyword) || article.content.includes(keyword)
                    )
                );
            }

            // æ’åºé€»è¾‘
            articles.sort((a, b) => {
                const dateA = new Date(a.date).getTime();
                const dateB = new Date(b.date).getTime();
                return sortType === 'newest' ? dateB - dateA : dateA - dateB;
            });

            // åˆ†é¡µé€»è¾‘
            const total = articles.length;
            currentFilter.totalPages = Math.ceil(total / pageSize);
            const startIndex = (page - 1) * pageSize;
            const currentPageArticles = articles.slice(startIndex, startIndex + pageSize);

            // æ¨¡æ‹ŸåŠ è½½å»¶è¿Ÿ
            setTimeout(() => {
                if (total === 0) {
                    listContainer.innerHTML = `
                        <div class="empty-state">
                            <<i>ğŸ“„</</i>
                            <p>æš‚æ— ç¬¦åˆæ¡ä»¶çš„æ–‡ç« </p>
                            <button class="btn btn-primary" onclick="document.getElementById('createBtn').click()">åˆ›å»ºæ–°æ–‡ç« </button>
                        </div>
                    `;
                    renderPagination();
                    return;
                }

                if (currentPageArticles.length === 0) {
                    listContainer.innerHTML = '<div class="empty-state"><p>å·²åŠ è½½å…¨éƒ¨æ–‡ç« </p></div>';
                    return;
                }

                listContainer.innerHTML = '';
                currentPageArticles.forEach(article => {
                    const articleTags = getArticleTags(article, categoryId);
                    const articleElement = document.createElement('div');
                    articleElement.className = 'article';
                    articleElement.innerHTML = `
                        <div class="article-info">
                            <div class="article-tags">
                                ${articleTags.map(tag => `<span class="article-tag">${tag}</span>`).join('')}
                            </div>
                            <h3 class="article-title">${article.title}</h3>
                            <p class="article-desc">${article.desc}</p>
                            <div class="article-meta">
                                <span class="article-date">${article.date}</span>
                                <span class="article-readtime">â±ï¸ ${Math.ceil(article.content.length / 500)}åˆ†é’Ÿé˜…è¯»</span>
                            </div>
                        </div>
                        <img src="${article.img || 'https://picsum.photos/200/150?random=0'}" alt="${article.title}" class="article-img">
                    `;
                    articleElement.addEventListener('click', () => {
                        window.location.hash = `#/article/${article.id}`;
                    });
                    listContainer.appendChild(articleElement);
                });

                renderPagination();
            }, 300);
        }

        // æå–æ–‡ç« æ ‡ç­¾
        function getArticleTags(article, categoryId) {
            const tags = categoryTagsMap[categoryId] || [];
            const articleText = `${article.title} ${article.desc} ${article.content}`;
            return tags
                .filter(tag => tag.name !== 'å…¨éƒ¨' && tag.keywords.some(key => articleText.includes(key)))
                .map(tag => tag.name)
                .slice(0, 2);
        }

        // æ¸²æŸ“åˆ†é¡µç»„ä»¶
        function renderPagination() {
            const paginationContainer = document.getElementById('pagination');
            const { page, totalPages } = currentFilter;

            if (totalPages <= 1) {
                paginationContainer.innerHTML = '';
                return;
            }

            let paginationHTML = `
                <button class="pagination-btn ${page === 1 ? 'disabled' : ''}" onclick="changePage(1)">é¦–é¡µ</button>
                <button class="pagination-btn ${page === 1 ? 'disabled' : ''}" onclick="changePage(${page - 1})">ä¸Šä¸€é¡µ</button>
            `;

            const startPage = Math.max(1, page - 2);
            const endPage = Math.min(totalPages, page + 2);
            for (let i = startPage; i <= endPage; i++) {
                paginationHTML += `<button class="pagination-btn ${page === i ? 'active' : ''}" onclick="changePage(${i})">${i}</button>`;
            }

            paginationHTML += `
                <button class="pagination-btn ${page === totalPages ? 'disabled' : ''}" onclick="changePage(${page + 1})">ä¸‹ä¸€é¡µ</button>
                <button class="pagination-btn ${page === totalPages ? 'disabled' : ''}" onclick="changePage(${totalPages})">æœ«é¡µ</button>
            `;

            paginationContainer.innerHTML = paginationHTML;
        }

        // åˆ‡æ¢é¡µç 
        function changePage(targetPage) {
            const { totalPages } = currentFilter;
            if (targetPage < 1 || targetPage > totalPages) return;
            currentFilter.page = targetPage;
            renderArticleListWithFilter();
        }

        // 9. åˆ›å»ºæ–‡ç« åŠŸèƒ½ï¼ˆå«MDä¸Šä¼ è§£æï¼‰
        const createBtn = document.getElementById('createBtn');
        const createForm = document.getElementById('createForm');
        const saveCreateBtn = document.getElementById('saveCreateBtn');
        const cancelCreateBtn = document.getElementById('cancelCreateBtn');
        // MDä¸Šä¼ ç›¸å…³DOM
        const mdFileInput = document.getElementById('mdFileInput');
        const mdUploadBtn = document.getElementById('mdUploadBtn');
        const mdFileName = document.getElementById('mdFileName');
        let mdContent = ''; // å­˜å‚¨è§£æåçš„MDå†…å®¹

        // MDä¸Šä¼ æŒ‰é’®è§¦å‘æ–‡ä»¶é€‰æ‹©
        mdUploadBtn.addEventListener('click', () => {
            mdFileInput.click();
        });

        // è¯»å–MDæ–‡ä»¶å†…å®¹å¹¶è§£æ
        mdFileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;
            if (file.type !== 'text/markdown' && !file.name.endsWith('.md')) {
                alert('è¯·é€‰æ‹©.mdæ ¼å¼çš„æ–‡ä»¶');
                mdFileInput.value = '';
                mdFileName.textContent = '';
                return;
            }

            // æ˜¾ç¤ºæ–‡ä»¶å
            mdFileName.textContent = `å·²é€‰æ‹©ï¼š${file.name}`;

            // è¯»å–æ–‡ä»¶å†…å®¹
            const reader = new FileReader();
            reader.onload = (event) => {
                const rawMd = event.target.result;
                // è§£æMDä¸ºHTMLï¼ˆç”¨äºæ–‡ç« contentï¼‰
                mdContent = marked.parse(rawMd);
                // æå–æ ‡é¢˜ï¼ˆå–ç¬¬ä¸€ä¸ª#åçš„å†…å®¹ï¼‰
                const titleMatch = rawMd.match(/^#\s+(.*?)(\n|$)/);
                if (titleMatch && titleMatch[1]) {
                    document.getElementById('articleTitle').value = titleMatch[1];
                }
                // æå–æ‘˜è¦ï¼ˆå–MDå†…å®¹å‰100ä¸ªå­—ç¬¦ï¼Œå»é™¤æ¢è¡Œï¼‰
                const pureText = rawMd.replace(/\s+/g, ' ').slice(0, 100) + '...';
                document.getElementById('articleDesc').value = pureText;
            };
            reader.readAsText(file);
        });

        createBtn.addEventListener('click', () => {
            createForm.classList.add('active');
            // é‡ç½®MDç›¸å…³çŠ¶æ€
            mdFileInput.value = '';
            mdFileName.textContent = '';
            mdContent = '';
            // åˆå§‹åŒ–è¡¨å•é»˜è®¤å€¼
            document.getElementById('articleTitle').value = '';
            document.getElementById('articleDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('articleDesc').value = '';
            document.getElementById('articleImg').value = `https://picsum.photos/200/150?random=${Math.floor(Math.random() * 100)}`;
            document.getElementById('articleCategory').value = currentFilter.categoryId;
        });

        function hideCreateForm() {
            createForm.classList.remove('active');
        }

        cancelCreateBtn.addEventListener('click', hideCreateForm);

        saveCreateBtn.addEventListener('click', () => {
            const title = document.getElementById('articleTitle').value.trim();
            const date = document.getElementById('articleDate').value;
            const desc = document.getElementById('articleDesc').value.trim();
            const img = document.getElementById('articleImg').value.trim();
            const category = document.getElementById('articleCategory').value;
            // ä¼˜å…ˆä½¿ç”¨MDè§£æçš„å†…å®¹ï¼Œæ— åˆ™ç”¨é»˜è®¤
            const content = mdContent || '<p>æƒ³è¯´ç‚¹ä»€ä¹ˆ...</p>';

            if (!title || !date || !desc) {
                alert('æ ‡é¢˜ã€æ—¥æœŸã€æ‘˜è¦ä¸èƒ½ä¸ºç©ºï¼');
                return;
            }

            const article = saveArticle({
                title, date, desc, img, category, content
            });

            hideCreateForm();
            currentFilter.page = 1;
            renderArticleListWithFilter();
            switchToCategory(category);
            alert('æ–‡ç« åˆ›å»ºæˆåŠŸï¼Œå¯ç‚¹å‡»æ–‡ç« è¿›å…¥è¯¦æƒ…é¡µï¼');
        });

        // 10. æ–‡ç« è¯¦æƒ…é¡µé€»è¾‘
        function showArticleDetail(articleId) {
            const article = getArticleById(articleId);
            if (!article) {
                alert('æ–‡ç« ä¸å­˜åœ¨');
                window.location.hash = '';
                return;
            }
            // éšè—å…¶ä»–é¡µé¢
            mainContent.style.display = 'none';
            archiveContent.style.display = 'none';
            editPage.style.display = 'none';
            createForm.style.display = 'none';
            // æ˜¾ç¤ºè¯¦æƒ…é¡µ
            const detailPage = document.getElementById('articleDetailPage');
            detailPage.style.display = 'block';
            // å¡«å……å†…å®¹
            document.getElementById('detailTitle').textContent = article.title;
            document.getElementById('detailDate').textContent = article.date;
            document.getElementById('detailCategory').textContent = article.category;
            document.getElementById('detailReadTime').textContent = `${Math.ceil(article.content.length / 500)}åˆ†é’Ÿé˜…è¯»`;
            document.getElementById('detailContent').innerHTML = article.content;
            // ç¼–è¾‘æŒ‰é’®äº‹ä»¶
            document.getElementById('editArticleBtn').addEventListener('click', () => {
                localStorage.setItem('editArticleId', articleId);
                window.location.hash = '#/edit';
            });
        }

        // 11. ç¼–è¾‘é¡µé€»è¾‘
        const editPage = document.getElementById('editPage');
        const backToDetailBtn = document.getElementById('backToDetailBtn');
        const saveEditBtn = document.getElementById('saveEditBtn');
        const nextStepBtn = document.getElementById('nextStepBtn');
        const editTitle = document.getElementById('editTitle');
        const editArticleId = document.getElementById('editArticleId');
        // ç¼–è¾‘é¡µMDä¸Šä¼ æ§ä»¶
        const editMdFileInput = document.getElementById('editMdFileInput');
        const editMdUploadBtn = document.querySelector('.edit-toolbar .tool-btn[title="ä¸Šä¼ MDæ›¿æ¢å†…å®¹"]');

        function showEditPage(article) {
            editTitle.value = article.title || '';
            editArticleId.value = article.id || '';
            quill.root.innerHTML = article.content || '<p>æƒ³è¯´ç‚¹ä»€ä¹ˆ...</p>';

            // éšè—å…¶ä»–é¡µé¢ï¼Œæ˜¾ç¤ºç¼–è¾‘é¡µ
            mainContent.style.display = 'none';
            archiveContent.style.display = 'none';
            articleDetailPage.style.display = 'none';
            createForm.style.display = 'none';
            editPage.style.display = 'flex';

            // æ§åˆ¶â€œä¸‹ä¸€æ­¥â€æŒ‰é’®çŠ¶æ€
            nextStepBtn.style.opacity = article.content && article.content.trim() !== '<p>æƒ³è¯´ç‚¹ä»€ä¹ˆ...</p>' ? '1' : '0.7';
            nextStepBtn.style.cursor = article.content && article.content.trim() !== '<p>æƒ³è¯´ç‚¹ä»€ä¹ˆ...</p>' ? 'pointer' : 'not-allowed';
        }

        backToDetailBtn.addEventListener('click', () => {
            window.location.hash = `#/article/${editArticleId.value}`;
        });

        saveEditBtn.addEventListener('click', () => {
            const id = editArticleId.value;
            const title = editTitle.value.trim();
            const content = quill.root.innerHTML;

            if (!id || !title) {
                alert('æ ‡é¢˜ä¸èƒ½ä¸ºç©ºï¼');
                return;
            }

            const articles = getArticles();
            const articleIndex = articles.findIndex(a => a.id === id);
            if (articleIndex === -1) return;

            articles[articleIndex].title = title;
            articles[articleIndex].content = content;

            localStorage.setItem(ARTICLE_KEY, JSON.stringify(articles));
            window.location.hash = `#/article/${id}`;
            alert('æ–‡ç« ä¿®æ”¹å·²ä¿å­˜ï¼');
        });

        // ä¸‹ä¸€æ­¥æŒ‰é’®é€»è¾‘ï¼ˆç¤ºä¾‹ï¼‰
        nextStepBtn.addEventListener('click', () => {
            if (nextStepBtn.style.opacity === '1') {
                alert('â€œä¸‹ä¸€æ­¥â€å¯æ‰©å±•ä¸ºå‘å¸ƒã€é¢„è§ˆç­‰é€»è¾‘');
            }
        });

        // ç¼–è¾‘é¡µMDä¸Šä¼ è§¦å‘
        editMdUploadBtn.addEventListener('click', () => {
            editMdFileInput.click();
        });

        // ç¼–è¾‘é¡µè¯»å–MDå¹¶æ›¿æ¢å†…å®¹
        editMdFileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file || (!file.name.endsWith('.md') && file.type !== 'text/markdown')) {
                alert('è¯·é€‰æ‹©.mdæ ¼å¼çš„æ–‡ä»¶');
                return;
            }

            const reader = new FileReader();
            reader.onload = (event) => {
                const rawMd = event.target.result;
                const htmlContent = marked.parse(rawMd);
                // æ›¿æ¢ç¼–è¾‘å™¨å†…å®¹
                quill.root.innerHTML = htmlContent;
                // åŒæ­¥æ›´æ–°æ ‡é¢˜
                const titleMatch = rawMd.match(/^#\s+(.*?)(\n|$)/);
                if (titleMatch && titleMatch[1]) {
                    editTitle.value = titleMatch[1];
                }
                // æ›´æ–°ä¸‹ä¸€æ­¥æŒ‰é’®çŠ¶æ€
                nextStepBtn.style.opacity = '1';
                nextStepBtn.style.cursor = 'pointer';
            };
            reader.readAsText(file);
        });

        // åº•éƒ¨å·¥å…·æŒ‰é’®é€»è¾‘ï¼ˆå›¾ç‰‡æ’å…¥ï¼‰
        document.getElementById('imgToolBtn').addEventListener('click', () => {
            const imgUrl = prompt('è¯·è¾“å…¥å›¾ç‰‡URLï¼š', 'https://picsum.photos/400/300?random=' + Math.floor(Math.random() * 100));
            if (imgUrl) {
                const range = quill.getSelection();
                if (range) {
                    quill.insertEmbed(range.index, 'image', imgUrl);
                    quill.setSelection(range.index + 1);
                }
            }
        });

        // è¾…åŠ©å‡½æ•°
        function getActiveCategoryId() {
            return currentFilter.categoryId;
        }

        function switchToCategory(categoryId) {
            const category = document.querySelector(`.category[data-page="${categoryId}"]`);
            if (category) category.click();
        }

        function initArticleRender() {
            const { categoryId } = currentFilter;
            renderTags(categoryId);
            renderArticleListWithFilter();
        }

        function hideAllPages() {
            articleDetailPage.style.display = 'none';
            editPage.style.display = 'none';
            createForm.style.display = 'none';
        }

        // è·¯ç”±å¤„ç†
        function handleRoute() {
            const hash = window.location.hash;
            if (hash.startsWith('#/article/')) {
                const articleId = hash.split('/')[2];
                showArticleDetail(articleId);
            } else if (hash === '#/edit') {
                const articleId = localStorage.getItem('editArticleId');
                if (articleId) {
                    showEditPage(getArticleById(articleId));
                } else {
                    window.location.hash = '';
                }
            } else {
                // æ˜¾ç¤ºæ¡£æ¡ˆé¡µæˆ–ä¸»é¡µ
                if (archiveContent.style.display === 'none') {
                    mainContent.style.display = 'block';
                } else {
                    initArticleRender();
                }
            }
        }

        // åˆå§‹åŒ–è·¯ç”±ç›‘å¬
        window.addEventListener('hashchange', handleRoute);
        window.addEventListener('load', () => {
            handleRoute();
            initDefaultArticles();
            // åŒæ­¥å¯Œæ–‡æœ¬ç¼–è¾‘å™¨åˆå§‹æ ·å¼
            document.querySelector('.ql-toolbar').style.backgroundColor = getComputedStyle(body).getPropertyValue('--category-bg');
            document.querySelector('.ql-container').style.backgroundColor = getComputedStyle(body).getPropertyValue('--bg');
        });
    </script>
</body>
</html>
